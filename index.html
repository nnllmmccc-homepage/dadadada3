<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Vercel Image/Video Host</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: #f5f5f5;
  text-align: center;
  margin: 50px;
}
input, button {
  padding: 10px 15px;
  margin-top: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
button {
  background: #0078ff;
  color: white;
  cursor: pointer;
}
button:hover { background: #005bcc; }
#preview img, #preview video {
  max-width: 300px;
  margin-top: 10px;
  border-radius: 10px;
}
#link {
  margin-top: 15px;
  font-weight: bold;
  color: #0078ff;
  word-break: break-all;
}
</style>
</head>
<body>
<h1>画像 / 動画 アップロード</h1>
<input type="file" id="fileInput" accept="image/*,video/mp4">
<button id="uploadBtn">アップロード</button>
<div id="preview"></div>
<div id="link"></div>

<script>
const fileInput = document.getElementById("fileInput");
const uploadBtn = document.getElementById("uploadBtn");
const preview = document.getElementById("preview");
const link = document.getElementById("link");

uploadBtn.onclick = async () => {
  const file = fileInput.files[0];
  if (!file) return alert("ファイルを選択してください");

  // プレビュー表示
  const reader = new FileReader();
  reader.onload = e => {
    preview.innerHTML = '';
    if (file.type.startsWith("video/")) {
      const v = document.createElement("video");
      v.src = e.target.result;
      v.controls = true;
      v.style.maxWidth = "300px";
      preview.appendChild(v);
    } else {
      const img = document.createElement("img");
      img.src = e.target.result;
      preview.appendChild(img);
    }
  };
  reader.readAsDataURL(file);

  // アップロード実行
  const formData = new FormData();
  formData.append("file", file);
  const res = await fetch("/api/upload", { method: "POST", body: formData });
  const data = await res.json();

  if (data.url) {
    link.innerHTML = `<a href="${data.url}" target="_blank">${data.url}</a>`;
  } else {
    alert("アップロードに失敗しました");
  }
};
</script>
</body>
</html>
